{% extends "base.html" %}
{% load static %}

{% block title %}Verification Report — DeepTrust{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto px-6 py-16">

    <!-- Title -->
    <h1 class="text-4xl font-bold text-blue-400 mb-6">
        Verification Report
    </h1>

    <p class="text-gray-300 mb-10">
        DeepTrust detected manipulation indicators, extracted claims, analyzed evidence,
        and computed a TruthScore for your content.
    </p>

    <!-- RESULTS WILL LOAD HERE -->
    <div id="reportContainer" class="space-y-10"></div>

</div>

<script>
const jobId = "{{ job_id }}";

async function loadReport() {
    const response = await fetch(`/api/report/${jobId}/`);
    const data = await response.json();

    const container = document.getElementById("reportContainer");

    container.innerHTML = `
        <!-- TRUTHSCORE -->
        <div class="bg-gray-800 border border-gray-700 p-8 rounded-2xl">
            <h2 class="text-2xl font-bold text-blue-400 mb-4">TruthScore™</h2>
            <p class="text-5xl font-bold text-white">${data.truthscore || 0}%</p>
            <p class="text-gray-400 mt-2">Higher score means stronger factual grounding and low manipulation.</p>
        </div>

        <!-- AUTHENTICITY -->
        <div class="bg-gray-800 border border-gray-700 p-8 rounded-2xl">
            <h2 class="text-2xl font-bold text-blue-400 mb-4">AI Manipulation Detection</h2>
            <p class="text-gray-300">Authenticity Score: <span class="text-blue-400 font-semibold">${data.authenticity_score}</span></p>

            ${data.text_ai_score !== null ?
                `<p class="text-gray-300 mt-1">Text AI Score: <span class="text-blue-400 font-semibold">${data.text_ai_score}</span></p>`
            : ""}
        </div>

        <!-- CLAIM CHECKING -->
        <div class="bg-gray-800 border border-gray-700 p-8 rounded-2xl">
            <h2 class="text-2xl font-bold text-blue-400 mb-4">Claim Analysis</h2>

            ${data.claim ?
                `
                <p class="text-gray-300"><strong>Extracted Claim:</strong></p>
                <p class="text-gray-200 bg-gray-900 p-4 rounded-lg mt-2">${data.claim.normalized_text}</p>

                <p class="mt-4 text-gray-300">
                    <strong>Verdict:</strong>
                    <span class="text-${data.claim.latest_verdict === 'Supported' ? 'green' : 'red'}-400 font-semibold">
                        ${data.claim.latest_verdict}
                    </span>
                </p>
                `
            :
                `<p class="text-gray-400">No claims extracted from this content.</p>`
            }
        </div>

        <!-- EVIDENCE -->
        <div class="bg-gray-800 border border-gray-700 p-8 rounded-2xl">
            <h2 class="text-2xl font-bold text-blue-400 mb-4">Evidence</h2>

            ${data.evidence && data.evidence.length > 0 ?
                data.evidence.map(ev => `
                    <div class="bg-gray-900 p-4 rounded-lg text-gray-300 mb-3">
                        ${ev}
                    </div>
                `).join("")
            :
                `<p class="text-gray-400">No evidence available or claim was supported without external sources.</p>`
            }
        </div>

        <!-- TRANSCRIPT -->
        ${data.transcript ?
        `
        <div class="bg-gray-800 border border-gray-700 p-8 rounded-2xl">
            <h2 class="text-2xl font-bold text-blue-400 mb-4">Transcript / OCR Text</h2>
            <p class="text-gray-300 whitespace-pre-wrap">${data.transcript}</p>
        </div>
        `
        : ""
        }
    `;
}

loadReport();
</script>

{% endblock %}
